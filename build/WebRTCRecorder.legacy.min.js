/*
 *****************************************************************************
 Copyright (c) Microsoft Corporation. All rights reserved.
 Licensed under the Apache License, Version 2.0 (the "License"); you may not use
 this file except in compliance with the License. You may obtain a copy of the
 License at http://www.apache.org/licenses/LICENSE-2.0

 THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
 WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
 MERCHANTABLITY OR NON-INFRINGEMENT.

 See the Apache Version 2.0 License for specific language governing permissions
 and limitations under the License.
*****************************************************************************/
var l=this;
function m(){function k(){k=Object.assign||function(d){for(var f,g=1,a=arguments.length;g<a;g++){f=arguments[g];for(var b in f)Object.prototype.hasOwnProperty.call(f,b)&&(d[b]=f[b])}return d};return k.apply(this,arguments)}var n;(function(d){d.VP8="vp8";d.VP9="vp9";d.Opus="Opus";d.iSAC="isac";d.iLBC="ilbc";d.H264="h264"})(n||(n={}));var e;(function(d){d.error="error";d.paused="paused";d.started="started";d.stopped="stopped"})(e||(e={}));var p={fps:60,format:"webm",codecs:n.l};return function(){function d(f,g){var a=
this;void 0===g&&(g=p);this.j=document.createElement("a");this.clearSourceBuffer=function(){if(a.f)for(var b=a.f.sourceBuffers,c=0;c<b.length;c++)a.f.removeSourceBuffer(b[c]);return a};this.clearSteam=function(){if(a.b)for(var b=a.b.getTracks(),c=0;c<b.length;c++)b[c].enabled=!1,b[c].stop(),a.b.removeTrack(b[c]);return a};this.destroy=function(){a.clearSourceBuffer().clearSteam();a.c=[];return a};this.download=function(b){void 0===b&&(b="untitled_"+(new Date).getTime());var c=window.URL.createObjectURL(new Blob(a.c,
{type:"video/"+a.options.format})),h=a.j;h.href=c;h.download=b+"."+a.options.format;document.body.appendChild(h);h.click();setTimeout(function(){document.body.removeChild(h);window.URL.revokeObjectURL(c)},0);return a};this.getBlob=function(){return new Blob(a.c,{type:"video/"+a.options.format})};this.getUrl=function(){return window.URL.createObjectURL(a.getBlob())};this.pause=function(){a.state===e.g&&a.a&&(a.a.pause(),a.state=e.paused);return a};this.resetOptions=function(b){a.options=k(k({},p),
b);return a.destroy().i()};this.resume=function(){a.state===e.paused&&a.a&&(a.a.resume(),a.state=e.g);return a};this.start=function(b){void 0===b&&(b=100);a.c=[];a.a=a.h();if(!a.a)return a.state=e.error,a;a.a.ondataavailable=function(c){c.data&&0<c.data.size&&a.c.push(c.data)};a.a.start(b);a.state=e.g;return a};this.stop=function(){a.state=e.stopped;a.a&&a.a.stop();return a};this.toggle=function(){a.state===e.stopped?a.start():a.state===e.g?a.stop():a.state===e.paused&&a.resume();return a};this.i=
function(){a.f=new MediaSource;a.b=a.canvas.captureStream(a.options.fps);return a};this.h=function(){var b=a.options,c=b.format;b={mimeType:"video/"+c+";codecs="+b.codecs};c={mimeType:"video/"+c};return MediaRecorder.isTypeSupported(b.mimeType)?new MediaRecorder(a.b,b):MediaRecorder.isTypeSupported(c.mimeType)?new MediaRecorder(a.b,c):!1};this.canvas=f;this.resetOptions(g)}d.isAvaliable=function(f){return MediaSource&&f.captureStream};return d}()}
"object"===typeof exports&&"undefined"!==typeof module?module.o=m():"function"===typeof define&&define.m?define(m):(l=l||self,l.WebRTCRecorder=m());
